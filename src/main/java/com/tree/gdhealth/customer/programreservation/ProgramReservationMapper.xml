<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tree.gdhealth.customer.programreservation.ProgramReservationMapper">
	<select id="selectProgramByMonth" resultType="java.util.Map">
		SELECT
		      YEAR(pd.program_date) year,
			  MONTH(pd.program_date) month,
			  DAY(pd.program_date) day,
			  COUNT(pr.program_date_no) cnt,
			  p.program_max_customer programMaxCustomer,
		      p.program_name programName
		FROM program_reservation pr RIGHT OUTER JOIN program_date pd
		  on pr.program_date_no = pd.program_date_no INNER JOIN program p
		  on p.program_no = pd.program_no
		WHERE YEAR(pd.program_date) = #{year}
		AND MONTH(pd.program_date) = #{month}
		GROUP BY pd.program_date
		ORDER BY pd.program_date ASC
	</select>
	
	<select id="allCalendarList" resultType="java.util.Map">
		SELECT
		    YEAR(pd.program_date) year,
			  MONTH(pd.program_date) month,
			  DAY(pd.program_date) day,
			  COUNT(pr.program_date_no) cnt,
			p.program_max_customer programMaxCustomer,
			p.program_name programName
		FROM program_reservation pr RIGHT OUTER JOIN program_date pd
		  on pr.program_date_no = pd.program_date_no INNER JOIN program p
		  on p.program_no = pd.program_no
		GROUP BY pd.program_date
		ORDER BY pd.program_date ASC
	</select>
	
	<select id="proRsOne" resultType="java.util.Map" parameterType="java.util.Map">
		SELECT
			  p.program_name programName,
			  pd.program_date programDate,
			  b.branch_name branchName,
			  pd.program_date_no programDateNo,
			  b.branch_no branchNo
		FROM program_reservation pr RIGHT OUTER JOIN program_date pd
		  on pr.program_date_no = pd.program_date_no INNER JOIN program p
		  on p.program_no = pd.program_no INNER JOIN employee e
		  	on e.employee_no = p.employee_no INNER JOIN branch b
		  	on e.branch_no = b.branch_no
 		WHERE YEAR(pd.program_date) = #{year}
		  AND MONTH(pd.program_date) = #{month}
		  AND DAY(pd.program_date) = #{day}
		  AND p.program_name = #{programName}
		ORDER BY pd.program_date ASC;
	</select>
</mapper>