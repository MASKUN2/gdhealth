<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tree.gdhealth.branch.sportsequipment.BranchSportsEquipmentMapper">

	<select id="getBranchOne" resultType="com.tree.gdhealth.vo.Branch">
		SELECT
		    branch_no branchNo,
		    branch_name branchName,
		    branch_tel branchTel,
		    branch_address branchAddress,
		    createdate,
		    updatedate,
		    branch_level branchLevel,
		    branch_active branchActive
		FROM branch
		WHERE branch_no = #{branchNo}
	</select>
	<select id="getOrderList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT seo.order_no orderNo,
			   seo.employee_orderer employeeOrderer,
			   oed.employee_name employeeOrdererName,
			   seo.branch_no branchNo,
			   bch.branch_name branchName,
			   seo.sports_equipment_no sportsEquipmentNo,
			   se.item_name itemName,
			   seo.quantity,
			   se.item_price itemPrice,
			   (seo.quantity * se.item_price) totalPrice,
			   seo.employee_approver employeeApprover,
			   aed.employee_name employeeApproverName,
			   seo.order_status orderStatus,
			   seo.createdate
		FROM sports_equipment_order seo
				 LEFT JOIN employee_detail oed ON seo.employee_orderer = oed.employee_no
				 LEFT JOIN branch bch ON seo.branch_no = bch.branch_no
				 LEFT JOIN sports_equipment se ON seo.sports_equipment_no = se.sports_equipment_no
				 LEFT JOIN employee_detail aed ON seo.employee_approver = aed.employee_no
		WHERE seo.branch_no = #{branchNo}
			<if test="isOnlyWaitingList">
				AND seo.order_status = '대기'
			</if>
		ORDER BY seo.createdate DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	<select id="getOrderListLastPage" resultType="java.lang.Integer">
		SELECT CEILING(COUNT(seo.order_no)/${rowPerPage}) AS lastPage
		FROM sports_equipment_order seo
		WHERE seo.branch_no = #{branchNo}
		<if test="isOnlyWaitingList">
			AND seo.order_status = '대기'
		</if>
		ORDER BY seo.createdate DESC
	</select>

</mapper>